jQuery(function () { function a() { var a = $("#thumbnails").find("img"), t = $("#hidImages").val(""), e = []; if (a.length > 0) { for (var n = 0, i = a.length; i > n; n++) { var o = $(a[n]).attr("data-id"); e.push(o) } t.val(e.join(",")) } } function t(a, t, e) { var n = $('<div class="col-md-3"></div>'), o = $('<div class="thumbnail"></div>'), l = $("<img/>").attr("src", t).attr("data-id", a), c = $('<input type="checkbox" name="chkimg"/>').val(a); e && c.attr("checked", !0); var r = $('<div class="col-md-6 text-left"></div>'); r.append(c), r.append("<span>主圖</span>"); var p = $('<i class="glyphicon glyphicon-remove removeimg"></i>').attr("id", a), d = $('<div class="col-md-6 text-right"></div>').append(p); o.append(l), o.append(d), n.append(o), n.append(r), n.append(d), n.appendTo(i) } function e(e) { e.stopPropagation(), e.preventDefault(); var i = new FormData; files = e.target.files, $.each(files, function (a, t) { i.append(a, t) }), $.ajax({ url: $("#imageuploadurl").val(), type: "POST", data: i, cache: !1, dataType: "json", processData: !1, contentType: !1, success: function (e, i, o) { n.val(""); for (var l = 0, c = e.length; c > l; l++) { var r = 0 == l; t(e[l].id, e[l].path, r) } a() }, error: function (a, t, e) { n.val(""), console.log("ERRORS: " + t) } }) } var n = $("#fileupload"), i = $("#thumbnails"); $("#btnupload").on("click", function () { $("#fileupload").trigger("click") }), n.on("change", function (a) { e(a) }), $("#thumbnails").delegate(".removeimg", "click", function (e) { e.stopPropagation(), e.preventDefault(); var i = $(this).attr("id"); $(this).closest(".col-md-3").remove(); var o = { id: i, path: "" }; $.ajax({ url: $("#imagedeleteurl").val(), type: "POST", data: JSON.stringify(o), cache: !1, dataType: "json", processData: !1, contentType: "application/json", success: function (e, i, o) { n.val(""); for (var l = 0, c = e.length; c > l; l++) { var r = 0 == l; t(e[l].id, e[l].path, r) } a() }, error: function (a, t, e) { n.val(""), console.log("ERRORS: " + t) } }) }) });